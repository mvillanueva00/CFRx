# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1rRy4QaWcWOoxL9qMqXH1fOTuCtqwkHNV
"""

import streamlit as st
import matplotlib.pyplot as plt
import pandas as pd
from io import BytesIO
from matplotlib.backends.backend_pdf import PdfPages

# Set up UI
st.title("Weekly Shipment Tracker")

# Date range input
st.subheader("Enter the date span for this shipment report")
date_span = st.text_input("Date range (e.g. 7/21/2025 - 7/25/2025)", value="7/21/2025 - 7/25/2025")

# Weekdays
days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]

# Input field names
fields = [
    "FedEx Delivery Tickets", "FedEx Patients",
    "DCS Delivery Tickets", "DCS Patients"
]

# Data dictionary
shipment_data = {field: [] for field in fields}

# Input section
st.subheader("Enter daily counts")
for day in days:
    st.markdown(f"### {day}")
    fedex_col, dcs_col = st.columns(2)

    with fedex_col:
        ft = st.number_input(f"FedEx Delivery Tickets ({day})", min_value=0, value=0, key=f"FedEx_Tickets_{day}")
        fp = st.number_input(f"FedEx Patients ({day})", min_value=0, value=0, key=f"FedEx_Patients_{day}")
        shipment_data["FedEx Delivery Tickets"].append(ft)
        shipment_data["FedEx Patients"].append(fp)

    with dcs_col:
        dt = st.number_input(f"DCS Delivery Tickets ({day})", min_value=0, value=0, key=f"DCS_Tickets_{day}")
        dp = st.number_input(f"DCS Patients ({day})", min_value=0, value=0, key=f"DCS_Patients_{day}")
        shipment_data["DCS Delivery Tickets"].append(dt)
        shipment_data["DCS Patients"].append(dp)

# Convert to DataFrame
df = pd.DataFrame(shipment_data, index=days)

# Chart: All 4 bar groups
fig, ax = plt.subplots(figsize=(10, 6))
colors = {
    "FedEx Delivery Tickets": "#4C72B0",
    "FedEx Patients": "#6BAED6",
    "DCS Delivery Tickets": "#E6550D",
    "DCS Patients": "#FDAE6B"
}
df.plot(kind='bar', ax=ax, color=[colors[col] for col in df.columns])
ax.set_ylabel("Count")
ax.set_title(f"Shipments & Patients by Courier ({date_span})")
ax.grid(axis='y')
plt.xticks(rotation=45)

# Add all totals to chart annotation
totals_text = (
    f"FedEx Tickets: {df['FedEx Delivery Tickets'].sum()}\n"
    f"FedEx Patients: {df['FedEx Patients'].sum()}\n"
    f"DCS Tickets: {df['DCS Delivery Tickets'].sum()}\n"
    f"DCS Patients: {df['DCS Patients'].sum()}"
)
ax.text(
    1.02, 0.5, totals_text,
    transform=ax.transAxes,
    verticalalignment='center',
    fontsize=10,
    bbox=dict(boxstyle='round,pad=0.4', facecolor='lightgray', edgecolor='gray')
)

plt.tight_layout()
st.pyplot(fig)

# Display all totals
st.subheader("Weekly Totals")
for field in fields:
    total = df[field].sum()
    st.write(f"**{field}:** {total}")

# Save chart to PDF
pdf_buffer = BytesIO()
with PdfPages(pdf_buffer) as pdf:
    pdf.savefig(fig)
pdf_buffer.seek(0)
pdf_data = pdf_buffer.read()

st.download_button(
    label="ðŸ“„ Download Chart as PDF",
    data=pdf_data,
    file_name="weekly_shipments.pdf",
    mime="application/pdf"
)
